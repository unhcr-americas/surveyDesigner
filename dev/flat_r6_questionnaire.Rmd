---
title: "questionnaire Object"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r development, include=FALSE}
library(testthat)
```

```{r development-load}
# Load already included functions if relevant
pkgload::load_all(export_all = FALSE)
library(readxl)
library(dplyr)
library(purrr)

```

# r6_Questionnaire


A questionnaire is created as a list that includes:
  * a summary of the annual survey cycle for a specific context
  * one or multiple [XlsForm](http://xlsform.org) that will be then used to collect information.

A questionnaire object is created out of two objects:
 * a global referential
 * a specific context 



```{r function-r6_questionnaire}
#' questionnaire class is a class to load, check and manipulate one or more than one XLSForm 
#' @importFrom R6 R6Class
#' 
#' @export

questionnaire <- R6::R6Class(classname = "questionnaire",
                           public = list(
                             #' @description 
                             #' read the xlsx for each sheet and return a named list
                             #' @param path path to the xlsForm
                             #' 
                             #' @importFrom readxl excel_sheets read_xlsx
                             #' @importFrom stats setNames
                             #' 
                             #' @return named list
                             initialize = function(path){
                               # Define path
                               self$path <- path
                               
                               # Get sheets of xlsx
                               sheets <- names_of_sheet(path)
                               
                               # Read the xlsx file 
                               data <- lapply(
                                 sheets, 
                                 function(x){
                                   read_xlsx(path = path, sheet = x)}) |>
                                      setNames(nm = sheets)
                               # TODO checking survey and other sheets
                             }
                           ),
                           private = list(
                             
                           )
)
```

```{r development-test}
ref <- questionnaire$new(
  path = system.file("household_survey_americas.xlsx", package = "surveyDesigner") 
)
```


```{r examples-r6_questionnaire}
ref <- questionnaire$new(
  path = system.file("household_survey_americas.xlsx", package = "surveyDesigner") 
)

head(ref$data$survey)

# Example by groups
ref$by_groups$group_intro
```

```{r tests-r6_questionnaire}
test_that("r6_questionnaire works", {
  ref <- questionnaire$new(
    path = system.file("household_survey_americas.xlsx", package = "surveyDesigner") 
  )
  
  expect_true( inherits(ref, "R6") )
  
  expect_error(
    questionnaire$new(
      path = "not_good_sheet.xlsx" 
    )
  )
  
  expect_error(
    questionnaire$new(
      path = "wt_xlsform_in_survey.xlsx" 
    )
  )

})
```


# Utils for questionnaire
    
```{r development-utils, eval = FALSE}




```


```{r function-utils_questionnaire}


```
  
  
```{r tests-utils_questionnaire}
test_that("utils_questionnaire works", {
  

})
```
  

```{r development-inflate, eval=FALSE}
# Run but keep eval=FALSE to avoid infinite loop
# Execute in the console directly
fusen::inflate(
  flat_file = "dev/flat_r6_questionnaire.Rmd", 
  vignette_name = "Class R6 for the questionnaire"
  )
```

